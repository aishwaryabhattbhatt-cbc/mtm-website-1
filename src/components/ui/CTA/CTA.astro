---
/* src/components/ui/CTA/CTA.astro */
import "./cta.css";
import InputField from "../Input/InputField.astro";
import Papa from 'papaparse';

// 1. Replace this with your "Published to Web" CSV URL
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQPEomf-ND9rIvS3zuXP7if7TPShcpPwWU9Hn7ROXTRo9L47iZ0ezoLg8H-GYZTveEw7fAHDMn5A0iT/pub?gid=1604665094&single=true&output=csv";

const response = await fetch(SHEET_URL);
const csvData = await response.text();

// 2. Parsing logic
const parsed = Papa.parse(csvData, { 
  header: false, 
  skipEmptyLines: true 
});

// Improved parsing logic to handle values in different columns
const rawData = Object.fromEntries(
  parsed.data.map((row) => {
    const key = row[0]?.toString().trim().toLowerCase();
    // Filter out empty cells and take the second valid entry as the value
    const values = row.slice(1).filter(v => v && v.trim() !== "");
    const value = values[0]?.toString().trim() || ""; 
    return [key, value];
  })
);



const {
  title2 = rawData["cta_title"] || "Ready to Get Started? Request a Demo Now.", 
  ctaLabel = "Request a Demo", // Hardcoded as requested
  ctaHref = "#" 
} = Astro.props;
---

<section class="cta-section">
  <div class="cta-box">
    <div class="cta-titles"> 
    <h4 class="h4">{title2}</h4>
    </div>
   
    <div class="cta-form">
        <InputField id="email" label="Email" type="email" required />
      </div>
    <a href={ctaHref} class="btn btn-primary button-l">
      {ctaLabel}
    </a>
    </div>
  </div>
</section>
