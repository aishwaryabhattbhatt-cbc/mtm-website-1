---
// src/components/ui/NavBar/Navbar.astro
import './navbar.css';

// 1. Import your new i18n tools
// Check your folder depth: you might need '../../i18n/ui' or '../../../i18n/ui'
import { getLangFromUrl, useTranslations } from '../../../i18n/ui.js'; 

// 2. Detect the language and setup the translator
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// 3. Define the base path for GitHub Pages (/mtm-website)
const base = import.meta.env.BASE_URL;

// 4. Update your menu to use the translator
const menuItems = [
  { key: "solutions", label: t("nav.solutions") || "Solutions", hasIcon: true, hasDropdown: true },
  { key: "products",  label: t("nav.products")  || "Products",  hasIcon: true, hasDropdown: true },
  { key: "tools",     label: t("nav.tools")     || "Tools",     hasIcon: true, hasDropdown: true },
  { key: "insights",  label: t("nav.insights")  || "Insights",  hasIcon: false, href: `/mtm-website-1/${lang}/insights`, hasDropdown: false },
];

// 5. Translate your CTA buttons
const primaryCtaLabel = t('nav.demo') || "Request A Demo";
const secondaryCtaLabel = t('nav.signin') || "Sign In";

const solutionsItems = [
  {
    id: "advertising",
    label: "Advertising",
    desc: "Plan media with audience, reach, and insights.",
    icon: "/mtm-website-1/icons/Solutions/advertising-active.svg",
    href: `/mtm-website-1/${lang}/solutions/advertising`,
  },
  {
    id: "media",
    label: "Media",
    desc: "Track platform behavior and content consumption shifts.",
    icon: "/mtm-website-1/icons/Solutions/media-active.svg",
    href: `/mtm-website-1/${lang}/solutions/media`,
  },
  {
    id: "industry",
    label: "Industry",
    desc: "Benchmark categories and consumer adoption over time.",
    icon: "/mtm-website-1/icons/Solutions/industry-active.svg",
    href: `/mtm-website-1/${lang}/solutions/industry`,
  },
  {
    id: "education",
    label: "Education",
    desc: "Support research and curriculum with reliable data.",
    icon: "/mtm-website-1/icons/Solutions/education-active.svg",
    href: `/mtm-website-1/${lang}/solutions/education`,
  },
  {
    id: "govn-ngo",
    label: "Govn & NGO",
    desc: "Inform policy and programs with population-level trends.",
    icon: "/mtm-website-1/icons/Solutions/govn-active.svg",
    href: `/mtm-website-1/${lang}/solutions/govn`,
  },
];

const productsItems = [
  {
    id: "mtm-18",
    label: "MTM 18+",
    desc: "Annual survey of Canadians 18+ on media and tech behaviors.",
    icon: "/mtm-website-1/icons/Products/18-active.svg",
    href: `/mtm-website-1/${lang}/products/mtm18`,
  },
  {
    id: "juniors",
    label: "Juniors",
    desc: "Youth media survey for Canadians ages 2–17.",
    icon: "/mtm-website-1/icons/Products/Jr-active.svg",
    href: `/mtm-website-1/${lang}/products/juniors`,
  },
  {
    id: "newcomers",
    label: "Newcomers",
    desc: "Media and tech habits of recent arrivals to Canada.",
    icon: "/mtm-website-1/icons/Products/NC-active.svg",
    href: `/mtm-website-1/${lang}/products/newcomers`,
  },
  {
    id: "census",
    label: "Census",
    desc: "Demographic context to power smarter decisions.",
    icon: "/mtm-website-1/icons/Products/Census-active.svg",
    href: `/mtm-website-1/${lang}/products/census`,
  },
];

const toolsItems = [
  {
    id: "data-analysis",
    label: "Data Analysis",
    desc: "Explore datasets with flexible cuts and comparisons.",
    icon: "/mtm-website-1/icons/Tools/data-analysis.svg",
    href: `/mtm-website-1/${lang}/tools/analysis-tools`,
  },
  {
    id: "trending",
    label: "Trending",
    desc: "See what’s rising, falling, and changing over time.",
    icon: "/mtm-website-1/icons/Tools/trending.svg",
    href: `/mtm-website-1/${lang}/tools/analysis-tools`,
  },
  {
    id: "forecasting",
    label: "Forecasting",
    desc: "Project outcomes with scenario-based forecasting.",
    icon: "/mtm-website-1/icons/Tools/forecasting.svg",
    href: `/mtm-website-1/${lang}/tools/analysis-tools`,
  },
  {
    id: "census-tools",
    label: "Census",
    desc: "Use demographic tools to enrich MTM insights.",
    icon: "/mtm-website-1/icons/Tools/explorer.svg",
    href: `/mtm-website-1/${lang}/tools/census-tools`,
  },
];
---

<div class="nav-bar">
  <div class="nav-inner">
    <div class="nav-main">
      <a
          href={`/mtm-website-1/`}
          class="nav-logo"
          aria-label="Go to home page"
        >
        <img src="/mtm-website-1/MTM-CLR.svg" alt="MTM Logo" class="nav-logo-img" />
      </a>
      
      <div class="nav-menu">
        {menuItems.map((item) => (
          <div class={`nav-item ${item.hasDropdown ? "has-dropdown" : ""}`}>
            <a
              href={item.href}
              class="btn btn-menu body-m-bold"
              {...(item.hasDropdown ? { "data-dropdown-trigger": item.key, "aria-expanded": "false" } : {})}
            >
              <span class="btn-text">{item.label}</span>

              {item.hasIcon && (
                <svg class="btn-icon" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M6 9l6 6 6-6" />
                </svg>
              )}
            </a>
          </div>
        ))}
      </div>
    </div>
  </div>

  {/* ONE shared mega dropdown */}
  <div id="navDropdown" class="nav-dropdown" aria-hidden="true">
    <div class="nav-dropdown-inner">
  
      {/* SOLUTIONS PANEL */}
      <div class="nav-panel" data-panel="solutions" hidden>
        <div class="nav-cards nav-cards--5">
          {solutionsItems.map((item) => (
            <a class="nav-card" href={item.href}>
              <img class="nav-card-icon" src={item.icon} alt="" aria-hidden="true" />
              <p class="body-m-bold nav-card-label">{item.label}</p>
              <p class="body-s text-muted nav-card-desc">{item.desc}</p>
            </a>
          ))}
        </div>
      </div>
  
      {/* PRODUCTS PANEL */}
      <div class="nav-panel" data-panel="products" hidden>
        <div class="nav-cards nav-cards--4">
          {productsItems.map((item) => (
            <a class="nav-card" href={item.href}>
              <img class="nav-card-icon" src={item.icon} alt="" aria-hidden="true" />
              <p class="body-m-bold nav-card-label">{item.label}</p>
              <p class="body-s text-muted nav-card-desc">{item.desc}</p>
            </a>
          ))}
        </div>
      </div>
  
      {/* TOOLS PANEL */}
      <div class="nav-panel" data-panel="tools" hidden>
        <div class="nav-cards nav-cards--4">
          {toolsItems.map((item) => (
            <a class="nav-card" href={item.href}>
              <img class="nav-card-icon" src={item.icon} alt="" aria-hidden="true" />
              <p class="body-m-bold nav-card-label">{item.label}</p>
              <p class="body-s text-muted nav-card-desc">{item.desc}</p>
            </a>
          ))}
        </div>
      </div>
  
  
    </div>
      
      

    </div>

    <div class="nav-actions">
      <div class="lang-toggle-group">
        <a href={`${base}/fr/`} 
           class={`lang-toggle body-m ${lang === 'fr' ? 'is-active' : ''}`} 
           aria-pressed={lang === 'fr'}>
          <span class="lang-icon"></span>
          <span class="lang-label">FR</span>
        </a>
      
        <a href={`${base}/`} 
           class={`lang-toggle body-m ${lang === 'en' || !lang ? 'is-active' : ''}`} 
           aria-pressed={lang === 'en' || !lang}>
          <span class="lang-icon"></span>
          <span class="lang-label">EN</span>
        </a>
      </div>

      <button class="btn btn-secondary button-l">{t('nav.signin') || 'Sign In'}</button>
      <button class="btn btn-primary button-l">{t('nav.demo') || 'Request A Demo'}</button>
    </div>
  </div>
</div>
</div>


<script src="./lang-toggle.js"></script>

<script type="module" src="/src/components/ui/NavBar/nav-dropdown.js"></script>

