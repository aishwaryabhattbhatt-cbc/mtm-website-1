---
// src/components/home/Reports/Reports.astro


import './reports.css';
import ReportInfo from '../../solutions/solution-reports/reportinfo.astro';
import Papa from 'papaparse';

// 1. Props from parent
const { 
  titleBase, 
  titleHighlight, 
  description, 
  buttonText, 
  statNumber, 
  statLabel,
  scene,
} = Astro.props;

// 2. Fetch CSV Data at build-time
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQPEomf-ND9rIvS3zuXP7if7TPShcpPwWU9Hn7ROXTRo9L47iZ0ezoLg8H-GYZTveEw7fAHDMn5A0iT/pub?gid=1805402128&single=true&output=csv";
const response = await fetch(SHEET_URL);
const csvData = await response.text();

// 3. Parse and Map the Data
const parsed = Papa.parse(csvData, { skipEmptyLines: true });
const rawData = {};
parsed.data.forEach(([key, value]) => {
  if (key) rawData[key.trim().toLowerCase()] = value?.trim();
});

// 4. Create the reportData array specifically for the MTM ID
const mtmReportData = [
  {
    id: "MTM",
    reportName: rawData["mtm_reportname"],
    reportImage: rawData["mtm_reportimage"], // Pull image path from CSV
    percentage: parseInt(rawData["mtm_col1_percentage"]) || 0,
    col1Title: rawData["mtm_col1_title"],
    col1Desc: rawData["mtm_col1_desc"],
    col2Icon: rawData["mtm_col2_icon"],
    col2Title: rawData["mtm_col2_title"],
    col2Desc: rawData["mtm_col2_desc"],
  }
];

---

<section class="reports">
  <div class="reports-grid">
    <div class="reports-placeholder">
      <div class="reports-left">
        <h2 class="h2">
          {titleBase} <span class="hl-text highlight-2">{titleHighlight}</span>
        </h2>
        <p class="subtitle body-m">{description}</p> 
        <a class="btn btn-tertiary button-l" href="#" role="button">{buttonText}</a>
      </div>
      
      <div class="reports-gap"></div>
      
      <div class="reports-right">
        <div class="display-title">{statNumber}</div> 
        <div class="body-text">
          <span class="subtitle-text" set:html={statLabel}></span> 
        </div>
      </div>
    </div>
 
    <div class="reports-image">
      <img src={mtmReportData[0].reportImage} alt="Reports Section" />
    </div>
    
    <div class="reports-footer">
      <ReportInfo reports={mtmReportData} />
    </div>
    
  </div>
</section>

<script src="./reports-delay.js"></script>
<script src="./reports-parallax.js"></script>
<script src="../../solutions/solution-reports/reportinfo.js"></script>