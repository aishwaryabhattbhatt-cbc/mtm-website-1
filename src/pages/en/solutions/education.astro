---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Navbar from "../../../components/ui/NavBar/nav-bar.astro";
import Grid from '../../../components/ui/Grid/grid.astro';
import HighlightText from '../../../components/ui/HighlightText/highlight-text.astro';
import Footer from "../../../components/ui/Footer/footer.astro";
import Subscribe from '../../../components/ui/Subscribe/subscribe.astro';
import CTA from "../../../components/ui/CTA/CTA.astro";
import Faq from "../../../components/solutions/faq/faq.astro";
import Testimonials from "../../../components/solutions/testimonials/testimonials.astro";
import DynamicCharts from "../../../components/solutions/dynamic-charts/dynamic-charts.astro";
import Percentage from "../../../components/ui/Percentage/percentage.astro";
import Benefits from "../../../components/solutions/benefits/benefits.astro";
import Reports from "../../../components/solutions/solution-reports/reports.astro";
import Hero from "../../../components/solutions/hero/Hero.astro";
import Papa from 'papaparse';

// 1. Replace this with your "Published to Web" CSV URL
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQPEomf-ND9rIvS3zuXP7if7TPShcpPwWU9Hn7ROXTRo9L47iZ0ezoLg8H-GYZTveEw7fAHDMn5A0iT/pub?gid=423293011&single=true&output=csv";

const response = await fetch(SHEET_URL);
const csvData = await response.text();

// 2. Parsing logic [cite: 6, 7, 24]
const parsed = Papa.parse(csvData, { 
  header: false, 
  skipEmptyLines: true 
});

const rawData = Object.fromEntries(
  parsed.data.map(([k, v]) => [k?.toString().trim().toLowerCase(), v?.toString().trim()])
);

// 3. Mapping Content using rawData [cite: 8, 24]
const heroContent = {
  solution: rawData["solution"], 
  titleHighlight: rawData["titlehighlight"], 
  titleBase: rawData["titlebase"],           
  subtitle: rawData["subtitle"],             
};

const benefitItems: any[] = []; 
for (let i = 1; i <= 5; i++) {
  if (rawData[`benefit_${i}_title`]) {
    benefitItems.push({
      icon: rawData[`benefit_${i}_icon`] || `/mtm-website-1/icons/Industry/benefit-${i}.svg`,
      title: rawData[`benefit_${i}_title`],
      description: rawData[`benefit_${i}_desc`],
    });
  }
}


const dynamicChartsContent = {
  title: rawData["charts_title"],
  
  // Pull from CSV with a hardcoded fallback path
  leftImage: rawData["charts_img_left"] || "/mtm-website-1/images/solutions/industry/dynamic-charts-left.png",
  rightImage: rawData["charts_img_right"] || "/mtm-website-1/images/solutions/industry/dynamic-charts-right.png",

  metrics: [
    {
      type: "component",
      component: Percentage,
      componentProps: { 
        percent: parseInt(rawData["metric_1_val"]) || 0 
      },
      text: rawData["metric_1_txt"]
    },
    {
      type: "icon",
      icon: rawData["metric_2_icon"] || "/mtm-website-1/images/solutions/industry/icon.svg",
      text: rawData["metric_2_txt"]
    }
  ]
};

const testimonialItems: any[] = []; 
if (rawData["testimonial_quote"]) {
  testimonialItems.push({
    quote: rawData["testimonial_quote"],
    role: rawData["testimonial_role"] || "Representative"
  });
}
const clientLogos = [
  rawData["testimonial_logo"] || "/mtm-website-1/client-logos/media.svg"
];

const faqs: any[] = [];
for (let i = 1; i <= 5; i++) {
  if (rawData[`faq_${i}_q`]) {
    faqs.push({
      question: rawData[`faq_${i}_q`],
      answer: rawData[`faq_${i}_a`],
    });
  }
}


const heroScene = {
  orbits: [
    { radius: 190, delay: 1 },
    { radius: 260, delay: 1.5 },
    { radius: 330, delay: 2 },
  ],
  image: "/mtm-website-1/images/solutions/education/hero-solution-education.webp",
  maskImage: "/mtm-website-1/images/solutions/education/hero-solution-education-mask.webp",
  orbitBlocker: "/mtm-website-1/images/solutions/hero-solution-white-blocker.png",
  particles: "/mtm-website-1/dots.png",
  centerOffset: { x: 0, y: 0 },

  icons: [
    {
      file: "/mtm-website-1/icons/Artboard 1.svg",
      orbit: 0, angle: 320, tooltip: "Audio Behavior"
    },
    {
      file: "/mtm-website-1/icons/Artboard 2.svg",
      orbit: 1, angle: 210, tooltip: "Video Viewing"
    },
    {
      file: "/mtm-website-1/icons/Artboard 3.svg",
      orbit: 2, angle: 170, tooltip: "Analytics"
    },
    {
      file: "/mtm-website-1/icons/Artboard 4.svg",
      orbit: 2, angle: 350, tooltip: "Mobile Usage"
    }
  ]
};



---

<BaseLayout title="MTM | Solutions for Education">
  <HighlightText />
  <Grid />
  <Navbar />

  <main class="page">
    <Hero 
      solution={heroContent.solution}
      titleHighlight={heroContent.titleHighlight}
      titleBase={heroContent.titleBase}
      subtitle={heroContent.subtitle}
      scene={heroScene} />
    <Benefits 
      title={rawData["benefits_title"]} 
      items={benefitItems} 
    />
    <Testimonials
    title={rawData["testimonial_title"] || "What media companies say about us"}
    subtitle={rawData["testimonial_subtitle"]}
    clientLogos={clientLogos}
    items={testimonialItems}
  />
    <Reports />
    <DynamicCharts
      title={dynamicChartsContent.title}
      leftImage={dynamicChartsContent.leftImage}
      rightImage={dynamicChartsContent.rightImage}
      metrics={dynamicChartsContent.metrics}
    />
    <Testimonials
      title={rawData["testimonial_title"] || "What media companies say about us"}
      subtitle={rawData["testimonial_subtitle"]}
      clientLogos={clientLogos}
      items={testimonialItems}
    />
    <Faq title="Frequently Asked Questions" items={faqs} />
    <CTA />
    <Subscribe />
    <Footer />
  </main>

  
</BaseLayout>