---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Navbar from "../../../components/ui/NavBar/nav-bar.astro";
import Grid from '../../../components/ui/Grid/grid.astro';
import HighlightText from '../../../components/ui/HighlightText/highlight-text.astro';
import Footer from "../../../components/ui/Footer/footer.astro";
import Subscribe from '../../../components/ui/Subscribe/subscribe.astro';
import CTA from "../../../components/ui/CTA/CTA.astro";
import Benefits from "../../../components/products/benefits/benefits.astro";
import Hero from "../../../components/products/hero/Hero.astro";
import Tools from "../../../components/products/tools-nc/tools.astro";
import Reports from "../../../components/products/reports/reports.astro";
import Methodology from "../../../components/products/methodology/methodology.astro";
import Other from "../../../components/products/other-products/other.astro";
import Papa from 'papaparse';

// 1. Replace this with your "Published to Web" CSV URL
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQPEomf-ND9rIvS3zuXP7if7TPShcpPwWU9Hn7ROXTRo9L47iZ0ezoLg8H-GYZTveEw7fAHDMn5A0iT/pub?gid=1662447318&single=true&output=csv";

const response = await fetch(SHEET_URL);
const csvData = await response.text();

// 2. Parsing logic [cite: 6, 7, 24]
const parsed = Papa.parse(csvData, { 
  header: false, 
  skipEmptyLines: true 
});

const rawData = Object.fromEntries(
  parsed.data.map(([k, v]) => [k?.toString().trim().toLowerCase(), v?.toString().trim()])
);


const heroScene = {
  orbits: [
    { radius: 190, delay: 1 },
    { radius: 260, delay: 1.5 },
    { radius: 330, delay: 2 },
  ],
  image: "/mtm-website-1/images/products/nc.webp",
  maskImage: "/mtm-website-1/images/products/nc-mask.webp",
  orbitBlocker: "/mtm-website-1/images/products/hero-blocker.png",

  // New grouped structure for side-by-side sets
  groups: [
    {
      centerOffset: { x: -150, y: -95 }, // Left set 
      orbits: [
        { radius: 120, delay: 1 },
        { radius: 180, delay: 1.5 },
        
      ],
      icons: [
        { file: "/mtm-website-1/icons/Artboard 1.svg", orbit: 0, angle: 220, tooltip: "Audio Behavior" },
        { file: "/mtm-website-1/icons/Artboard 2.svg", orbit: 1, angle: 160, tooltip: "Video Viewing" },
      ]
    },
    {
      centerOffset: { x: 100, y: -95}, // Right set 
      orbits: [
      { radius: 120, delay: 2 },
      { radius: 180, delay: 2.5 },
      ],
      icons: [
        { file: "/mtm-website-1/icons/Artboard 3.svg", orbit: 0, angle: 340, tooltip: "Analytics" },
        { file: "/mtm-website-1/icons/Artboard 4.svg", orbit: 1, angle: 30, tooltip: "Mobile Usage" }
      ]
    }
  ]
};

const benefitItems: any[] = []; 
for (let i = 1; i <= 5; i++) {
  if (rawData[`benefit_${i}_title`]) {
    benefitItems.push({
      icon: rawData[`benefit_${i}_icon`] || `/mtm-website-1/icons/Industry/benefit-${i}.svg`,
      title: rawData[`benefit_${i}_title`],
      description: rawData[`benefit_${i}_desc`],
    });
  }
}


---

<BaseLayout title="MTM | MTM 18+">
  <HighlightText />
  <Grid />
  <Navbar />

  <main class="page">
    <Hero 
    solution={rawData["solution"]}
    titleBase={rawData["titlebase"]}
    subtitle={rawData["subtitle"]}
    scene={heroScene} 
    />
    <Benefits 
      items={benefitItems} 
    />
    <Tools 
    header={{
      title: rawData["tools_header_title"],
      subtitle: rawData["tools_header_subtitle"]
    }}
    datTool={{
      title: rawData["dat_tool_title"],
      description: rawData["dat_tool_description"],
      tipText: rawData["dat_tool_tip_text"],
      image: "/mtm-website-1/images/products/products-dat-tool-18.webp"
    }}
    trendingTool={{
      title: rawData["trending_tool_title"],
      description: rawData["trending_tool_description"],
      tipText: rawData["trending_tool_tip_text"],
      image: "/mtm-website-1/images/products/tools-18-trending.webp"
    }}
    forecastingTool={{
      title: rawData["forecasting_tool_title"],
      description: rawData["forecasting_tool_description"],
      tipText: rawData["forecasting_tool_tip_text"],
      image: "/mtm-website-1/images/products/tools-18-forecast.webp"
    }}
  />

  <Reports 
    content={{
      title: rawData["reports_title"],
      subtitle: rawData["reports_subtitle"],
      primaryBtnText: rawData["reports_primary_btn_text"],
      secondaryBtnText: rawData["reports_secondary_btn_text"],
      leftImage: "/mtm-website-1/images/products/graphs/left-image.png",
      rightImage: "/mtm-website-1/images/products/graphs/right-graph.svg"
    }}
    benefit1={{
      icon: "/mtm-website-1/icons/Products/report-info/benefit-1.svg",
      title: rawData["report_benefit_1_title"],
      description: rawData["report_benefit_1_desc"]
    }}
    benefit2={{
      icon: "/mtm-website-1/icons/Products/report-info/benefit-2.svg",
      title: rawData["report_benefit_2_title"],
      description: rawData["report_benefit_2_desc"]
    }}
  />

  <Methodology 
    content={{
      title: rawData["methodology_title"],
      subtitle: rawData["methodology_subtitle"],
      image: "/mtm-website-1/images/products/methodology-nc.webp",
      // Left Pillar
      leftStat1Title: rawData["left_stat1_title"],
      leftStat1Desc: rawData["left_stat1_desc"],
      leftStat2Title: rawData["left_stat2_title"],
      leftStat2Value: parseInt(rawData["left_stat2_value"]),
      leftStat2Desc: rawData["left_stat2_desc"],
      leftStat3Title: rawData["left_stat3_title"],
      leftStat3Desc: rawData["left_stat3_desc"],
      leftStat4Title: rawData["left_stat4_title"],
      leftStat4Desc: rawData["left_stat4_desc"],

      // Right Pillar
      rightStat1Title: rawData["right_stat1_title"],
      rightStat1Desc: rawData["right_stat1_desc"],
      rightStat2Title: rawData["right_stat2_title"],
      rightStat2Value: parseInt(rawData["right-stat2_value"]),
      rightStat2Desc: rawData["right_stat2_desc"],
      rightStat3Title: rawData["right_stat3_title"],
      rightStat3Desc: rawData["right_stat3_desc"],
      rightStat4Title: rawData["right_stat4_title"],
      rightStat4Desc: rawData["right_stat4_desc"],
      //Button
      btnText: rawData["btn_text"]
    }} 
  />
    <CTA />
    <Other 
      title={rawData["other_title"]}
      card1={{
        title: rawData["card1_title"],
        subtitle: rawData["card1_subtitle"],
        image: "/mtm-website-1/images/home/products/segments-Jr.webp"
      }}
      card2={{
        title: rawData["card2_title"],
        subtitle: rawData["card2_subtitle"],
        image: "/mtm-website-1/images/home/products/segments-18.webp"
      }}
    />
    <Subscribe />
    <Footer />
  </main>


  
</BaseLayout>